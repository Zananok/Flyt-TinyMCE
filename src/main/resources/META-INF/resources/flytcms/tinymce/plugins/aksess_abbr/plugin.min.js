/**
 * Created by rubfag on 31.07.2015.
 */

tinymce.PluginManager.add('aksess_abbr', function(editor, url) {
    function showDialog() {
        abbr=editor.selection.getNode().title;
        txt=editor.selection.getContent({format : 'text'});

        editor.windowManager.open({
            title: 'Abbreviation',
            body: {type: 'textbox', name: 'name', size: 40, label: 'Name', value: abbr},
            onsubmit: function(e) {

                var node = editor.dom.getParent(editor.selection.getNode(), "abbr");
                if (node) {
                    editor.execCommand('mceRemoveNode', false, node);
                }
                editor.selection.setNode(tinymce.activeEditor.dom.create('abbr', {title: e.data.name},txt));
            }
        });
    }

    editor.addButton('aksess_abbr', {
        tooltip: 'Abbreviation',
        //icon: 'anchor',//'abbr',
        image: url + '/img/label.png',
        stateSelector: 'abbr',
        onclick: showDialog
    });

    editor.addMenuItem('aksess_abbr', {
        text: 'Abbreviation',
        //icon: 'anchor',
        image: url + '/img/label.png',
        context: 'insert',
        onclick: showDialog
    });
});
